<div class="min-vh-100 py-4" style="background: #eaf6f9">
  <div class="container-lg">
    <div class="card shadow-lg border-0" style="border-radius: 14px">
      <!-- <div
        class="card-header text-white d-flex align-items-center gap-2"
        style="
          background: #36393c;
          border-top-left-radius: 14px;
          border-top-right-radius: 14px;
        "
      >
        <i class="fas fa-chart-line fs-4"></i>
        <h4 class="mb-0 fw-bold">Dashboard</h4>
      </div> -->

      <div class="card-body p-4">
        <div class="mb-5 position-relative panel-wrap">
          <div
            class="card border-0"
            style="border-radius: 12px; background: #e3e3e3"
          >
            <div
              class="card-header text-white fw-semibold"
              style="
                background: #2f2f30;
                border-top-left-radius: 12px;
                border-top-right-radius: 12px;
              "
            >
              {{ laminationData.title || "Parts wait move" }}
            </div>

            <div class="card-body p-4">
              <!-- แถบหัว + สรุป -->
              <div
                class="d-flex align-items-center justify-content-between mb-4"
              >
                <!-- กรอบเขียว -->
                <div
                  class="flex-grow-1 d-flex justify-content-between align-items-center p-3 rounded-3"
                  style="background: #79f2a2"
                >
                  <span class="fw-semibold fs-5">{{
                    laminationData.header || "Lamination"
                  }}</span>

                  <div class="d-flex gap-4">
                    <span 
                      class="summary-chip"
                      [ngClass]="{ 'notify': checkNotifyWait === 1 }"
                      >
                        <ng-container *ngIf="checkNotifyWait === 1">
                          <i class="fas fa-bell blink me-1"></i>
                        </ng-container>
                        wait : {{ laminationData.waitCount }}
                    </span>
                    <span 
                    class="summary-chip"
                    [ngClass]="{ 'pending-notify': checkNotifyPending === 1 }"
                  >
                  <ng-container *ngIf="checkNotifyPending === 1">
                    <i class="fas fa-bell blink me-1"></i>
                  </ng-container>
                  pending : {{ laminationData.pendingCount }}
                  </span
                    >
                  </div>
                </div>

                <!-- ปุ่มอยู่นอกกรอบ แต่บรรทัดเดียวกัน -->
                <button
                  class="btn btn-primary ms-3"
                  data-bs-toggle="modal"
                  data-bs-target="#modalRegister"
                  (click)="openModal()"
                >
                  <i class="fa fa-file-alt me-1"></i> Add Job
                </button>
                
              </div>
              <span>
                <i class="fas fa-phone-volume ml-4"> : To Calling</i>
                <i class="fas fa-user-circle  ml-4"> : Owner Job</i>
              </span>
          
              <div class="mt-3">
                <!-- กล่องที่ *จำกัดความสูง* และมี scrollbar -->
                <div class="lam-preview-scroll"
                #lamScrolPanel
                (scroll)="onLamScroll()"
                (click)="onLamClick()"
                >
                  <div class="list-group rounded-3 overflow-hidden">
                    <div
                      class="list-group-item d-flex align-items-center justify-content-between"
                      *ngFor="let item of laminationData.Rows"
                    >
                      <div class="d-flex align-items-center gap-3">
                        <span class="mono fw-semibold">{{ item.date }}</span>
                        <span class="mono fw-semibold">{{ item.time }}</span>
                        <span class="fw-semibold">{{ item.machineName }}</span>
                        
                        @if (item.priority === "urgent") {
                          <span class="urgent-badge">
                            <i class="fas fa-fire"></i>
                          </span>
                        }

                        @if (item.remark) {
                          <ng-container *ngIf="isLongRemark(item.remark); else shortRemark2">
                            <span class="remark-wrap">
                              <button type="button" class="remark-pill">
                                <i class="fas fa-comment-dots"></i>
                              </button>
                        
                              <span class="remark-tooltip">
                                {{ item.remark }}
                              </span>
                            </span>
                          </ng-container>
                        
                          <ng-template #shortRemark2>
                            <span class="remark-text">{{ item.remark }}</span>
                          </ng-template>
                        }
                      </div>
                      <div class="d-flex align-items-center gap-2"> 
                      
                        
                        @if (userId === item.createByUserId) {
                          <i class="fas fa-user-circle text-primary"></i>
                        }
                        @if (valueUserCallNodeId === item.toNodeId) {
                           <i class="fas fa-phone-volume"></i>
                        }
                        <span class="node-tag" > {{ item.toNodeName}} </span>
                        <span
                          class="badge rounded-pill px-3 py-2 text-capitalize status-pill"
                          [ngClass]="item.status === 'wait' ? 'status-wait' : 'status-pending'"
                        >
                          {{ item.status }}
                        </span>

                     

                        @if (valueUserCallNodeId === item.toNodeId) {
                          <button 
                            class="btn btn-sm d-flex align-items-center gap-1 fw-semibold" 
                            style="background:#12d32f; color:rgb(10, 8, 8); border-radius:8px; box-shadow:0 2px 4px rgba(0,0,0,0.15);"
                            
                            >
                            <i class="fas fa-edit"></i>
                            Accept
                          </button>
                          <button 
                          class="btn btn-sm d-flex align-items-center gap-1 fw-semibold" 
                          style="background:#eb1207; color:rgb(255, 255, 255); border-radius:8px; box-shadow:0 2px 4px rgba(0,0,0,0.15);"
                          
                          >
                          <i class="fas fa-times"></i>

                          Cancel
                        </button>
                        <button 
                        class="btn btn-sm d-flex align-items-center gap-1 fw-semibold" 
                        style="background:#463df1; color:rgb(255, 255, 255); border-radius:8px; box-shadow:0 2px 4px rgba(0,0,0,0.15);"
                        
                        >
                        <i class="fas fa-check-circle"></i>
                        Confirm
                      </button>
                        

                       }
                       <button
                       class="detail-icon-btn"
                       (click)="onDetail(item)"
                       title="View detail"
                     >
                       <i class="fas fa-bars"></i>
                   </button>

                    </div>
                    </div>
                  </div>
                </div>
              </div>

            </div>

          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<app-modal-template
  #assignJobModal
  [modalName]="modalName"
  [empNo]="empNo"
  [userCallNodeId]="valueUserCallNodeId"
  [userGroupId]="groupId"
  [groups]="groups"
  [machines]="machines"
  [callNodes]="callNodes"
  [filterByGroupFromNodecallNodes]="filterByGroupFromNodecallNodes"
  [userId]="userId"
  [userName]="userName"
  [isLoading]="isLoading"
  (machineSelectedId)="onMachineSelected($event)"
  (callNodeToSelectedId)="onCallNodeToSelected($event)"
  (remarkValue)="onRemarkValue($event)"
  (priorityValue)="onPriorityValue($event)"
  (saved)="onSaved($event)"
>
</app-modal-template>





