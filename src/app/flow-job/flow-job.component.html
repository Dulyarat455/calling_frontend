<div style="overflow-x:hidden;">
<div class="mt-3">
    <div class="card-header">Map FlowJob Page</div>
    <div class="card-body mt-3">
      <button
        class="btn btn-primary me-2"
        data-bs-toggle="modal"
        data-bs-target="#modalRegister"
        (click)="openModal()"
      >
        <i class="fa fa-user-plus me-2"></i>Add Position
      </button>
      <!-- <button
        class="btn btn-success me-2"
        data-bs-toggle="modal"
        data-bs-target="#modalExcel"
      >
        <i class="fa fa-upload me-2"></i>Add by Excel file
      </button>
      <button class="btn btn-success">
        <i class="fa fa-download me-2"></i>Export to Excel
      </button> -->
      <div class="form-inline mt-3">
        <div class="input-group">
          <input
          type="text"
          class="form-control"
          placeholder="ค้นหา From / To / Group / Status"
          [(ngModel)]="searchText"
          (input)="onSearchChange()"
        />
        
          <div class="input-group-append">
            <button class="btn btn-primary">
              <i class="fas fa-search fa-fw"></i>
            </button>
          </div>
        </div>
      </div>
      <table class="table table-bordered table-striped mt-3 mb-5">
        <thead>
          <tr>
            <th>FromNode</th>
            <th>ToNode</th>
            <th>Group</th>
            <th>Status</th>
            <th width="50px">แก้ไข</th>
            <th width="50px">ลบ</th>
          </tr>
        </thead>
        <tbody>
            @for (item of flowJobs; track $index) {
                <tr>
                  <td>{{item.fromNodeName}}</td>
                  <td>{{item.toNodeName}}</td>
                  <td>{{item.groupName}}</td>
                  <td>{{item.status}}</td>
                  <td class="text-center">
                    <button
                      class="btn btn-primary"
                      (click)="edit(item)"
                      data-bs-target="#modalRegister"
                      data-bs-toggle="modal"
                    >
                      <i class="fa fa-edit"></i>
                    </button>
                  </td>
                  <td class="text-center">
                    <button class="btn btn-danger" (click)="remove(item)">
                      <i class="fa fa-times"></i>
                    </button>
                  </td>
                </tr>
                }
        </tbody>
      </table>
    </div>
  </div>
</div>

  <app-my-modal modalId="modalFlowJob" (closeRequest)="myModal.close()">
    <div class="login-container" style="margin-top: 25px;margin-bottom: 25px;">
        <div class="login-card" style="padding-bottom: 20px;">
          <div class="card-header text-center">
            <h5 class="mb-0 fw-bold">
              <i class="fas fa-layer-group me-2"></i>
              Map FlowJobs
            </h5>
          </div>
    
          <div class="card-body">
    
            <!-- Title -->
            <div class="section-title mt-2 mb-3">
              <span class="line"></span>
              <span>{{ modalMode === 'edit' ? 'Edit FlowJob' : 'Add FlowJob' }}</span>
              <span class="line"></span>
            </div>
  
  
            <div class="input-group mb-3">
              <span class="input-group-text">
                <i class="fas fa-user-cog"></i>
              </span>
              <select
                class="form-select text-center"
                [(ngModel)]="selectedGroupId"
                (change)="fetchCallNodeByGroup()"
                [disabled]="isLoading"
              >
                <option [ngValue]="null" disabled> --------------- Group  -----------------</option>
                <option *ngFor="let g of groups" [ngValue]="g.id">
                  {{ g.name }}
                </option>
               
              </select>
            </div>
  
            <div class="input-group mb-3">
              <span class="input-group-text">
                <i class="fas fa-user-cog"></i>
              </span>
              <select
                class="form-select text-center"
                [(ngModel)]="selectedFromNodeId"
                [disabled]="isLoading || !selectedGroupId"
              >
                <option [ngValue]="null" disabled> --------------- FromNode  -----------------</option>
                <option *ngFor="let c of callNodes" [ngValue]="c.id">
                  {{ c.code }}
                </option>
              </select>
            </div>
  
  
            
            <div class="input-group mb-3">
              <span class="input-group-text">
                <i class="fas fa-user-cog"></i>
              </span>
              <select
                class="form-select text-center"
                [(ngModel)]="selectedToNodeId"
                [disabled]="isLoading || !selectedGroupId" 
              > <!-- ถ้ายังไม่เลือก section ให้ disable -->
  
                <option [ngValue]="null" disabled> --------------- ToNode  -----------------</option>
                <option *ngFor="let c of callNodes" [ngValue]="c.id">
                  {{ c.code }}
                </option>
              </select>
            </div>
  
            
            <!-- Buttons -->
            <div class="mt-4">
              <button class="btn btn-primary w-100" (click)="submitFlowJob()" [disabled]="isLoading">
                @if(isLoading){
                  <i class="fas fa-spinner fa-spin me-2"></i>Processing...
                } @else {
                  <i class="fas fa-save me-2"></i>
                  {{ modalMode === 'edit' ? 'Update FlowJob' : 'Save FlowJob' }}
                }
              </button>
              
    
              <button class="btn btn-secondary w-100 mt-3" (click)="clearForm()" [disabled]="isLoading">
                <i class="fas fa-times me-2"></i> Clear
              </button>
            </div>
    
          </div>
        </div>
      </div>      
  </app-my-modal>