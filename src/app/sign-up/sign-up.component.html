<div style="overflow-x:hidden;">
<div class="mt-3">
  <div class="card-header">Register Page</div>
  <div class="card-body mt-3">
    <button
      class="btn btn-primary me-2"
      data-bs-toggle="modal"
      data-bs-target="#modalRegister"
      (click)="clearForm(); openModal()"
    >
      <i class="fa fa-user-plus me-2"></i>Register Employee
    </button>
    <button
    class="btn btn-success me-2"
    type="button"
    (click)="excelInput.click()"
  >
    <i class="fa fa-upload me-2"></i>Add by Excel file
  </button>
  
  <!-- input file ซ่อนไว้ -->
  <input
    #excelInput
    type="file"
    accept=".xlsx"
    style="display:none"
    (change)="onExcelSelected($event)"
  />
    <button class="btn btn-success" (click)="downloadExcel()">
      <i class="fa fa-download me-2"></i>Export to Excel
    </button>
    <div class="form-inline mt-3">
      <div class="input-group">
      
        <input
        type="text"
        class="form-control"
        style="min-width: 360px;"
        placeholder="ค้นหา (empNo / name / group / section / rfid)"
        [(ngModel)]="searchEmpNo"
        (input)="filterEmpNo()"
      />
      
      <div class="input-group-append">
        <button class="btn btn-primary" (click)="filterEmpNo()">
          <i class="fas fa-search fa-fw"></i>
        </button>
        <button class="btn btn-secondary" (click)="clearSearch()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      </div>
    </div>
    <table class="table table-bordered table-striped mt-3">
      <thead>
        <tr>
          <th>รหัสพนักงาน</th>
          <th>Name</th>
          <th>Role</th>
          <th>RFID</th>
          <th>Group</th>
          <th>Section</th>
          <th>Subsection</th>
          <th>Satus</th>
          <th width="50px">แก้ไข</th>
          <th width="50px">ลบ</th>
        </tr>
      </thead>
      <tbody>
        @for (item of users; track $index) {
        <tr>
          <td>{{ item.empNo }}</td>
          <td>{{ item.name }}</td>
          <td>{{ item.role }}</td>
          <td>{{ item.rfId }}</td>
          <td>{{ item.groupName }}</td>
          <td>{{ item.sectionName }}</td>
          <td>{{ item.subSectionName }}</td>
          <td>{{ item.status }}</td>
          <td class="text-center">
            <button
              class="btn btn-primary"
              (click)="onEditClick(item)"
            >
              <i class="fa fa-edit"></i>
            </button>
          </td>
          <td class="text-center">
            <button class="btn btn-danger" (click)="remove(item)">
              <i class="fa fa-times"></i>
            </button>
          </td>
        </tr>
        }
      </tbody>
    </table>
  </div>
</div>
</div>

<app-my-modal modalId="modalSignUp" (closeRequest)="myModal.close()">
        <div class="login-container">
          <div class="login-card">
            <div class="card-header">
              <h6 class="text-center mb-0">
                {{ isEditMode ? 'Edit Member' : 'Add Members' }}
              </h6>
            </div>
        
            <div class="card-body">
              <!-- Account Info Section -->
              <div class="login-section">
                <div class="section-title">
                  <span class="line"></span>
                  <span>Account Information</span>
                  <span class="line"></span>
                </div>
      
                <div class="input-group mb-2">
                  <span class="input-group-text">
                    <i class="fas fa-id-card"></i>
                  </span>
                  <input
                    #rfidInput
                    type="text"
                    class="form-control"
                    placeholder="RFID (optional)"
                    [(ngModel)]="rfId"
                    [disabled]="isLoading"
                  />
                </div>
        
                <div class="input-group mb-2">
                  <span class="input-group-text">
                    <i class="fas fa-id-badge"></i>
                  </span>
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Full Name"
                    [(ngModel)]="name"
                    [disabled]="isLoading"
                  />
                </div>
        
                <div class="input-group mb-2">
                  <span class="input-group-text">
                    <i class="fas fa-hashtag"></i>
                  </span>
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Employee No."
                    [(ngModel)]="empNo"
                    [disabled]="isLoading"
                  />
                </div>
        
              
        
                <div class="input-group mb-3">
                  <span class="input-group-text">
                    <i class="fas fa-user-cog"></i>
                  </span>
                  <select
                    class="form-select text-center"
                    [(ngModel)]="role"
                    [disabled]="isLoading"
                  >
                    <option value="" disabled selected> ----------------- role -----------------</option>
                    <option value="user">User</option>
                    <option value="admin">Admin</option>
                  </select>
                </div>
      
                <div class="input-group mb-3">
                  <span class="input-group-text">
                    <i class="fas fa-user-cog"></i>
                  </span>
                  <select
                    class="form-select  text-center"
                    [(ngModel)]="selectedGroupId"
                    (change)="fetchSectionByGroup()"
                    [disabled]="isLoading"
                  >
                  <option [ngValue]="null" disabled> ----------------- Group -----------------</option>
                  <option *ngFor="let g of groups" [ngValue]="g.id">
                    {{ g.name }}
                  </option>
                  </select>
                </div>

                <div class="input-group mb-3">
                  <span class="input-group-text">
                    <i class="fas fa-user-cog"></i>
                  </span>
                  <select
                    class="form-select text-center"
                    [(ngModel)]="selectedSectionId"
                    (change)="fetchSubSectionByGroupSection()"
                    [disabled]="isLoading || !selectedGroupId"
                  >
                    <option [ngValue]="null" disabled> --------------- Section  -----------------</option>
                    <option *ngFor="let s of sections" [ngValue]="s.id">
                      {{ s.name }}
                    </option>
                  </select>
                </div>
      
                
                <div class="input-group mb-3">
                  <span class="input-group-text">
                    <i class="fas fa-user-cog"></i>
                  </span>
                  <select
                    class="form-select text-center"
                    [(ngModel)]="selectedSubSectionId"
                    [disabled]="isLoading || !selectedSectionId" 
                  >
                    <option [ngValue]="null" disabled> --------------- SubSection  -----------------</option>
                    <option *ngFor="let ss of subSections" [ngValue]="ss.id">
                      {{ ss.name }}
                    </option>
                  </select>
                </div>


               
      
              </div>
        
              <!-- Security Section -->
              <div class="login-section mt-3">
                <div class="section-title">
                  <span class="line"></span>
                  <span>Security</span>
                  <span class="line"></span>
                </div>
        
                <div class="input-group mb-2">
                  <span class="input-group-text">
                    <i class="fas fa-lock"></i>
                  </span>
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Password"
                    [(ngModel)]="password"
                    [disabled]="isLoading"
                  />
                </div>
        
                <button class="btn btn-primary w-100" (click)="addMember()" [disabled]="isLoading">
                  @if (isLoading) { Processing... }
                  @else { {{ isEditMode ? 'Update Member' : 'Add Member' }} }
                </button>
        
                <button
                  class="btn btn-secondary w-100 mt-3"
                  (click)="clearForm()"
                  [disabled]="isLoading"
                >
                  <i class="fas fa-times me-2"></i>
                  Clear
                </button>
              </div>
            </div>
          </div>
        </div>
  </app-my-modal>