<div class="mt-3">
    <div class="card-header">Report Page</div>
    <div class="card-body mt-3">
      
      <button class="btn btn-success">
        <i class="fa fa-download me-2"></i>Export to Excel
      </button>
       
      <div class="row mt-3 g-3">
        <!-- Start -->
        <div class="col-md-3">
          <label class="form-label mb-1">Start date</label>
          <input type="date" class="form-control" [(ngModel)]="draft.startDate" />
        </div>
      
        <!-- End -->
        <div class="col-md-3">
          <label class="form-label mb-1">End date</label>
          <input type="date" class="form-control" [(ngModel)]="draft.endDate" />
        </div>
      
        <!-- Call From -->
        <div class="col-md-3 position-relative">
          <label class="form-label mb-1">Call From*</label>
        
          <input
            type="text"
            class="form-control"
            placeholder="-- Select Node --"
            [(ngModel)]="fromKeyword"
            (focus)="showFromDrop = true; filterFromNodes()"
            (input)="filterFromNodes()"
            (blur)="onFromBlur()"
          />
        
          <ul
            class="list-group position-absolute w-100 shadow"
            *ngIf="showFromDrop && filteredFromNodes.length"
            style="z-index:1000; max-height:220px; overflow:auto;"
          >
            <li
              class="list-group-item list-group-item-action"
              *ngFor="let c of filteredFromNodes"
              (mousedown)="selectFromNode(c)"
            >
              {{ c.code }}
            </li>
          </ul>
        </div>
        
      
        <!-- Call To -->
        <div class="col-md-3 position-relative">
          <label class="form-label mb-1">Call To*</label>
        
          <input
            type="text"
            class="form-control"
            placeholder="-- Select Node --"
            [(ngModel)]="toKeyword"
            (focus)="showToDrop = true; filterToNodes()"
            (input)="filterToNodes()"
            (blur)="onToBlur()"
          />
        
          <ul
            class="list-group position-absolute w-100 shadow"
            *ngIf="showToDrop && filteredToNodes.length"
            style="z-index:1000; max-height:220px; overflow:auto;"
          >
            <li
              class="list-group-item list-group-item-action"
              *ngFor="let c of filteredToNodes"
              (mousedown)="selectToNode(c)"
            >
              {{ c.code }}
            </li>
          </ul>
        </div>
        
      
        <!-- Machine -->
        <div class="col-md-3 position-relative">
          <label class="form-label mb-1">Machine*</label>
        
          <input
            type="text"
            class="form-control"
            placeholder="-- Select Machine --"
            [(ngModel)]="machineKeyword"
            (focus)="showMachineDrop = true; filterMachines()"
            (input)="filterMachines()"
            (blur)="onMachineBlur()"
          />
        
          <ul
            class="list-group position-absolute w-100 shadow"
            *ngIf="showMachineDrop && filteredMachines.length"
            style="z-index:1000; max-height:220px; overflow:auto;"
          >
            <li
              class="list-group-item list-group-item-action"
              *ngFor="let m of filteredMachines"
              (mousedown)="selectMachine(m)"
            >
              {{ m.code }}
            </li>
          </ul>
        </div>


        <div class="col-md-2">
          <label class="form-label mb-1">Shift</label>
          <select class="form-select" [(ngModel)]="draft.shift">
            <option [ngValue]="null">All</option>
            <option [ngValue]="'A'">A (07:00 - 15:10)</option>
            <option [ngValue]="'B'">B (15:00 - 23:10)</option>
            <option [ngValue]="'C'">C (23:00 - 07:10)</option>
          </select>
        </div>
        
        
      
        <!-- Job No. (อยู่บรรทัดเดียวกับ Machine) -->
        <div class="col-md-4">
          <label class="form-label mb-1">Job No.</label>
          <div class="input-group">
            <input
              type="text"
              class="form-control"
              placeholder="ค้นหา Job No."
              [(ngModel)]="draft.jobNo"
            />
           
          </div>
        </div>
      
        <!-- ปุ่ม Filter แยก -->
        <div class="col-md-2 d-flex align-items-end">
          <button
            class="btn btn-primary w-100"
            type="button"
            (click)="applyFilter()"
          >
          <i class="fas fa-search me-2"></i>Search
          </button>
          <button class="btn btn-outline-secondary ms-2" type="button" (click)="clearFilter()">
            Reset
          </button>
        </div>
      </div>
      
            
          


      <div class="report-table-wrap mt-3">
      <table class="table table-bordered table-striped mt-3 report-table">
        <thead>
            <tr>
              <th width="120">
                <div class="head-title">Job No.</div>
                <div class="head-hint">Running</div>
              </th>
        
              <th width="160">
                <div class="head-title">Date</div>
                <div class="head-hint">
                  From<br>
                  To
                </div>
              </th>
        
              <th width="80">
                <div class="head-title">Shift</div>
                <div class="head-hint">
                  Drop down<br>
                  A, B, C
                </div>
              </th>
        
              <th width="100">
                <div class="head-title">M/C</div>
                <div class="head-hint">Drop down</div>
              </th>
        
              <th width="130">
                <div class="head-title">Call from</div>
                <div class="head-hint">
                  Drop down<br>
                  Master
                </div>
              </th>
        
              <th width="130">
                <div class="head-title">Call to</div>
                <div class="head-hint">
                  Drop down<br>
                  Master
                </div>
              </th>
        
              <th width="110">
                <div class="head-title">Start time</div>
                <div class="head-hint">hh:mm</div>
              </th>
        
              <th width="110">
                <div class="head-title">Finish time</div>
                <div class="head-hint">hh:mm</div>
              </th>
        
              <th width="120">
                <div class="head-title">finish time</div>
                <div class="head-hint">
                  hh:mm<br>
                  Calculate
                </div>
              </th>
              <th width="120">
                <div class="head-title">Wait time</div>
                <div class="head-hint">
                  hh:mm<br>
                  Calculate
                </div>
              </th>
              
              <th width="120">
                <div class="head-title">Work time</div>
                <div class="head-hint">
                  hh:mm<br>
                  Calculate
                </div>
              </th>
              
        
              <th width="140">
                <div class="head-title">Call by</div>
                <div class="head-hint">Input&nbsp;&nbsp;Input</div>
              </th>
        
              <th width="140">
                <div class="head-title">Incharge by</div>
                <div class="head-hint">Input&nbsp;&nbsp;Input</div>
              </th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let row of filteredRows">
              <!-- Job No. -->
              <td>{{ row.jobId }}</td>
          
              <!-- Date (From / To) -->
              <td>
                <div>{{ formatDate(row.createAt) }}</div>
                <div class="text-muted small">
                  {{ formatDate(row.userIncharge?.date) }}  
                </div>
              </td>
          
              <!-- Shift (ตอนนี้ยังไม่มี logic → ใส่ - ไว้ก่อน) -->
              <td>
                {{ getShift(row.createAt) }}
             </td>
          
              <!-- M/C -->
              <td>{{ row.machineName }}</td>
          
              <!-- Call from -->
              <td>{{ row.fromNodeName }}</td>
          
              <!-- Call to -->
              <td>{{ row.toNodeName }}</td>
          
              <!-- Start time -->
              <td>{{ formatTime(row.createAt) }}</td>
          
              <!-- Finish time -->
              <td>{{ formatTime(row.userIncharge?.date) }}</td>
          
              <!-- Wait time (Finish - Start) -->
              <td>
                {{ calcTime(row, 'total') }}
              </td>
              <!-- Wait time -->
              <td>
                {{ calcTime(row, 'wait') }}
              </td>

              <!-- Work time -->
              <td>
                {{ calcTime(row, 'work') }}
              </td>

          
              <!-- Call by -->
              <td>
                <div>{{ row.createByuserEmpNo }}</div>
                <div class="text-muted small">{{ row.createByuserName }}</div>
              </td>
          
              <!-- Incharge by -->
              <td>
                <div>{{ row.userIncharge?.userEmpNo || '-' }}</div>
                <div class="text-muted small">
                  {{ row.userIncharge?.userName || '-' }}
                </div>
              </td>
            </tr>
          </tbody>
      </table>
    </div>

    </div>
  </div>

  <app-my-modal modalId="modalGroup" (closeRequest)="myModal.close()">
    <div class="login-container" style="margin-top: 25px;margin-bottom: 25px;">
      <div class="login-card" style="padding-bottom: 20px;">
        <div class="card-header text-center">
          <h5 class="mb-0 fw-bold">
            <i class="fas fa-layer-group me-2"></i>
            Add Group
          </h5>
        </div>
  
        <div class="card-body">
  
          <!-- Title -->
          <div class="section-title mt-2 mb-3">
            <span class="line"></span>
            <span>Add Group Name</span>
            <span class="line"></span>
          </div>
  
          <!-- Input -->
          <div class="input-group mb-4">
            <span class="input-group-text">
              <i class="fas fa-tag"></i>
            </span>
            <input
              type="text"
              class="form-control"
              placeholder="Group Name"
             
              [disabled]="isLoading"
            />
          </div>
  
          <!-- Buttons -->
          <div class="mt-4">
            <button class="btn btn-primary w-100"  [disabled]="isLoading" (click)="add()">
              @if(isLoading){
                <i class="fas fa-spinner fa-spin me-2"></i>Processing...
              } @else {
                <i class="fas fa-save me-2"></i> Save Group
              }
            </button>
  
            <button class="btn btn-secondary w-100 mt-3" [disabled]="isLoading" (click)="clearForm()">
              <i class="fas fa-times me-2"></i> Clear
            </button>
          </div>
  
        </div>
      </div>
    </div>
  </app-my-modal>
  